<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vylex CryptoPulse - Bitcoin & Blockchain News</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Stay ahead with Vylex CryptoPulse – your trusted source for daily Bitcoin updates, blockchain insights, and crypto market trends." />
  <meta name="keywords" content="Bitcoin, Blockchain, Crypto News, Cryptocurrency, DeFi, Ethereum, Bitcoin News, CryptoPulse, Vylex, Web3, Crypto Trends" />
  <meta name="author" content="Vylex Media" />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph for Social Sharing -->
  <meta property="og:title" content="Vylex CryptoPulse - Bitcoin & Blockchain News" />
  <meta property="og:description" content="Get real-time crypto insights and breaking blockchain updates with Vylex CryptoPulse." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://vylexcryptopulse.com" />
  <meta property="og:image" content="https://vylexcryptopulse.com/og-image.jpg" />

  <!-- Twitter Card for Enhanced Sharing -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Vylex CryptoPulse - Bitcoin & Blockchain News" />
  <meta name="twitter:description" content="Get the latest on Bitcoin, Ethereum, and DeFi. Vylex CryptoPulse keeps you in the loop." />
  <meta name="twitter:image" content="https://vylexcryptopulse.com/twitter-image.jpg" />

  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <style>
    :root {
      /* Web3/Crypto Inspired Palette */
      --primary: #8A2BE2; /* BlueViolet - kept for now, or could be #F7931A for Bitcoin Orange */
      --primary-rgb: 138, 43, 226;
      --secondary: #00f2ff; /* Bright Cyan */
      --bg-light: #f0f2f5;
      --bg-dark: #121212;
      --card-light: white;
      --card-dark: #1e1e1e;
      --text-light: #1f1f1f;
      --text-dark: #e0e0e0;
      --header-light: #ffffff;
      --header-dark: #181818;
      --border-light: #e0e0e0;
      --border-dark: rgba(255, 255, 255, 0.1);
      --shadow-light: rgba(0,0,0,0.1);
      --shadow-dark: rgba(0,0,0,0.4);
      --glow-dark: rgba(var(--primary-rgb), 0.3);
      --positive-change: #4CAF50; /* Green for positive price change */
      --negative-change: #F44336; /* Red for negative price change */
    }

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: var(--bg-dark);
      color: var(--text-dark);
      transition: background 0.3s ease, color 0.3s ease;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    body:not(.dark-mode) {
      background: var(--bg-light);
      color: var(--text-light);
    }

    header {
      background: var(--header-dark);
      color: var(--text-dark);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-dark);
      transition: background 0.3s ease, border-color 0.3s ease;
      flex-shrink: 0;
    }

    body:not(.dark-mode) header {
      background: var(--header-light);
      color: var(--text-light);
      border-bottom: 1px solid var(--border-light);
    }

    .header-title {
      text-align: left;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }
     header h1 .icon {
        display: inline-block;
        margin-right: 8px;
        filter: drop-shadow(0 0 5px var(--glow-dark));
        font-size: 1.2em; /* Make Bitcoin icon slightly larger */
        vertical-align: middle;
     }

    header p {
      margin: 5px 0 0;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .connect-wallet-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease, filter 0.3s ease, box-shadow 0.3s ease;
        font-size: 0.9rem;
    }
    .connect-wallet-btn:hover {
        filter: brightness(0.9);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--glow-dark);
    }
    body:not(.dark-mode) .connect-wallet-btn {
        box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.3);
    }
     body:not(.dark-mode) .connect-wallet-btn:hover {
        box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.4);
        filter: brightness(1);
     }

    .container {
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
      padding: 1.5rem 1rem;
      width: 100%;
      box-sizing: border-box;
    }

    main.container {
        flex-grow: 1;
        padding-top: 1.5rem;
        padding-bottom: 1.5rem;
    }

    .card {
      background: var(--card-dark);
      border-radius: 12px;
      border: 1px solid var(--border-dark);
      box-shadow: 0 4px 10px var(--shadow-dark);
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      transition: transform 0.2s ease, background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
    }
    body:not(.dark-mode) .card {
      background: var(--card-light);
      border: 1px solid var(--border-light);
      box-shadow: 0 3px 8px var(--shadow-light);
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px var(--glow-dark);
      border-color: rgba(var(--primary-rgb), 0.5);
    }
     body:not(.dark-mode) .card:hover {
      box-shadow: 0 5px 15px var(--shadow-light);
      border-color: var(--primary);
     }
    .card a {
      text-decoration: none;
      color: var(--primary);
      font-weight: 600;
    }
     body:not(.dark-mode) .card a {
       color: var(--primary);
     }
     .card a:hover { text-decoration: underline; }
    .card img {
      max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 1rem; display: block;
    }
     .card h3 { margin-top: 0; margin-bottom: 0.5rem; font-size: 1.15rem; line-height: 1.4; }
     .card p { font-size: 0.9rem; opacity: 0.8; margin-bottom: 0.5rem; line-height: 1.5; }
     .card p:last-child { margin-bottom: 0; }
     .card .meta-info { font-size: 0.8rem; opacity: 0.6; margin-top: 1rem; }

    /* Bitcoin Price Widget Styles */
    .bitcoin-price-widget { margin-bottom: 1.5rem; }
    .bitcoin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 15px;
    }
    .bitcoin-title { display: flex; align-items: center; gap: 10px; }
    #bitcoin-icon { font-size: 2.5rem; color: #F7931A; /* Bitcoin Orange */ }
    .bitcoin-title h2 { font-size: 1.3rem; margin: 0; color: var(--text-dark); }
    body:not(.dark-mode) .bitcoin-title h2 { color: var(--text-light); }

    .currency-selector label { font-size: 0.9rem; margin-right: 8px; opacity: 0.8; }
    .currency-selector select {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid var(--border-dark);
        background: var(--bg-dark);
        color: var(--text-dark);
        font-size: 0.9rem;
        cursor: pointer;
    }
    body:not(.dark-mode) .currency-selector select {
        background: var(--bg-light);
        color: var(--text-light);
        border: 1px solid var(--border-light);
    }
    .currency-selector select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(var(--primary-rgb), 0.2);
    }
    .bitcoin-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
    }
    .stat-item { padding: 0.5rem 0; }
    .stat-item .label { display: block; font-size: 0.85rem; opacity: 0.7; margin-bottom: 4px; }
    .stat-item .value { font-size: 1.2rem; font-weight: 600; }
    #bitcoin-price { font-size: 1.8rem; color: var(--primary); }
    #bitcoin-change.positive { color: var(--positive-change); }
    #bitcoin-change.negative { color: var(--negative-change); }
    .data-source-notice {
        font-size: 0.75rem; opacity: 0.6; text-align: right; margin-top: 1rem; margin-bottom: 0;
    }


    .controls {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1.5rem; flex-wrap: wrap; gap: 15px; padding: 1rem;
      background: var(--card-dark); border-radius: 12px; border: 1px solid var(--border-dark);
    }
     body:not(.dark-mode) .controls { background: var(--card-light); border: 1px solid var(--border-light); }
    .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 24px; }
    body:not(.dark-mode) .slider { background-color: #ccc; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(26px); }
    .theme-toggle { display: flex; align-items: center; gap: 10px; font-size: 1.2rem; }
    .category-filter { display: flex; gap: 10px; flex-wrap: wrap; }
    .category-btn {
      background: transparent; border: 1px solid var(--border-dark); color: var(--text-dark);
      padding: 6px 15px; border-radius: 20px; cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      font-size: 0.9rem; font-weight: 500;
    }
    body:not(.dark-mode) .category-btn { color: var(--text-light); border: 1px solid var(--border-light); }
    .category-btn:hover { border-color: var(--primary); color: var(--primary); }
    .category-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    .loading { text-align: center; padding: 30px; opacity: 0.7; font-size: 1rem; }
    .error {
      background: rgba(255, 0, 0, 0.1); color: #ff8a8a;
      border: 1px solid rgba(255, 0, 0, 0.3);
      padding: 15px; border-radius: 8px; margin-bottom: 1.5rem; font-weight: 500;
    }
    body:not(.dark-mode) .error { background: #ffdddd; color: #d8000c; border: 1px solid #ffbaba; }

    .site-footer {
        background: var(--header-dark); color: var(--text-dark);
        padding-top: 2rem; padding-bottom: 1rem;
        border-top: 1px solid var(--border-dark); margin-top: auto;
        transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        flex-shrink: 0;
    }
    body:not(.dark-mode) .site-footer {
        background: var(--header-light); color: var(--text-light);
        border-top: 1px solid var(--border-light);
    }
    .footer-content { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
    .quote-section {
        width: 100%; max-width: 600px; text-align: center; margin-bottom: 0;
    }
    .quote-section h2 {
        margin-top: 0; font-size: 1.3rem; color: var(--primary); margin-bottom: 0.8rem;
    }
    #quote-text {
        font-size: 1rem; font-style: italic; opacity: 0.9; min-height: 3em;
        margin: 1rem 0; line-height: 1.5; transition: opacity 0.3s ease;
    }
    #quote-text:empty::before { content: "Click the button for some crypto wisdom!"; opacity: 0.6; }
    #quote-button {
        background: transparent; border: 1px solid var(--primary); color: var(--primary);
        padding: 8px 18px; border-radius: 20px; cursor: pointer;
        transition: background 0.3s ease, color 0.3s ease, opacity 0.3s ease;
        font-weight: 600; font-size: 0.9rem;
    }
    #quote-button:hover:not(:disabled) { background: var(--primary); color: white; }
    #quote-button:disabled { opacity: 0.6; cursor: not-allowed; }
    .footer-bottom { text-align: center; width: 100%; font-size: 0.85rem; opacity: 0.7; margin-top: 1rem; }
    .footer-links { margin-bottom: 0.5rem; }
    .footer-links a { color:#00f2ff; text-decoration: none; margin: 0 8px; transition: color 0.2s ease; }
    .footer-links a:hover { color: var(--primary); text-decoration: underline; }
    .copyright { margin: 0; font-size: 0.8rem; }

    @media (max-width: 768px) {
        header { flex-direction: column; align-items: flex-start; gap: 10px; }
        .connect-wallet-btn { align-self: flex-end; }
        main.container { padding-top: 1rem; padding-bottom: 1rem;}
        .bitcoin-header { flex-direction: column; align-items: flex-start; }
    }
    @media (max-width: 600px) {
      .container { padding-left: 0.5rem; padding-right: 0.5rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .theme-toggle { justify-content: center; }
      .category-filter { justify-content: center; }
      header h1 { font-size: 1.3rem; }
      .bitcoin-stats { grid-template-columns: 1fr; /* Stack stats on small screens */ }
      .stat-item .value { font-size: 1.1rem; }
      #bitcoin-price { font-size: 1.5rem; }
      .site-footer { padding-top: 1.5rem; }
      .quote-section { padding: 1rem; }
      #quote-text { font-size: 0.95rem; }
      .footer-bottom { font-size: 0.8rem; }
      .footer-links a { margin: 0 5px;}
    }
  </style>
</head>
<body class="dark-mode">
  <header>
    <div class="header-title">
      <h1><span class="icon">₿</span> Vylex CryptoPulse</h1>
      <p>Your Daily Dose of Crypto & Bitcoin News</p>
    </div>
    <button class="connect-wallet-btn">Connect Wallet</button>
  </header>

  <main class="container">
    <!-- Bitcoin Price Widget -->
    <div class="bitcoin-price-widget card" id="bitcoin-price-widget">
        <div class="bitcoin-header">
            <div class="bitcoin-title">
                <span id="bitcoin-widget-icon">₿</span>
                <h2>Bitcoin (BTC) Live Price</h2>
            </div>
            <div class="currency-selector">
                <label for="currency-select">Currency:</label>
                <select id="currency-select">
                    <option value="usd">USD</option>
                    <option value="eur">EUR</option>
                    <option value="gbp">GBP</option>
                    <option value="jpy">JPY</option>
                    <option value="zar">ZAR</option>
                </select>
            </div>
        </div>
        <div class="bitcoin-stats">
            <div class="stat-item">
                <span class="label">Price:</span>
                <span class="value" id="bitcoin-price">Loading...</span>
            </div>
            <div class="stat-item">
                <span class="label">24h Change:</span>
                <span class="value" id="bitcoin-change">--%</span>
            </div>
            <div class="stat-item">
                <span class="label">Market Cap:</span>
                <span class="value" id="bitcoin-market-cap">--</span>
            </div>
            <div class="stat-item">
                <span class="label">24h Volume:</span>
                <span class="value" id="bitcoin-volume">--</span>
            </div>
        </div>
        <p class="data-source-notice">Price data from CoinGecko</p>
    </div>

    <!-- Controls: Theme Toggle & Category Filter -->
    <div class="controls">
      <div class="category-filter" id="category-filter">
        <button class="category-btn active" data-source="all_crypto">All Crypto</button>
        <button class="category-btn" data-source="bitcoin">Bitcoin</button>
        <button class="category-btn" data-source="ethereum">Ethereum</button>
        <button class="category-btn" data-source="altcoins">Altcoins</button>
        <button class="category-btn" data-source="defi">DeFi</button>
        <button class="category-btn" data-source="nfts">NFTs</button>
      </div>
      <div class="theme-toggle">
        <span>☀️</span>
        <label class="switch">
          <input type="checkbox" id="dark-mode-toggle" checked>
          <span class="slider"></span>
        </label>
        <span>🌙</span>
      </div>
    </div>

    <div id="error-container"></div>

    <div id="news-container">
      <div class="loading" id="loading">Loading CryptoPulse Feed...</div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-content container">
        <div class="quote-section card">
            <h2>🧠 Crypto Wisdom</h2>
            <p id="quote-text"></p>
            <button id="quote-button" onclick="getCryptoQuote()">💬 Get Crypto Insight</button>
        </div>
        <div class="footer-bottom">
            <div class="footer-links">
                <a href="https://vylexnexys.co.za" target="_blank" rel="noopener noreferrer">VylexNexys</a>
            </div>
            <p class="copyright">© 2025 VylexNexys. All rights reserved.</p>
        </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- SELECTORS ---
      const newsContainer = document.getElementById('news-container');
      const loadingElement = document.getElementById('loading');
      const errorContainer = document.getElementById('error-container');
      const darkModeToggle = document.getElementById('dark-mode-toggle');
      const categoryButtons = document.querySelectorAll('.category-btn');

      // Bitcoin Price Widget Selectors
      const bitcoinPriceEl = document.getElementById('bitcoin-price');
      const bitcoinChangeEl = document.getElementById('bitcoin-change');
      const bitcoinMarketCapEl = document.getElementById('bitcoin-market-cap');
      const bitcoinVolumeEl = document.getElementById('bitcoin-volume');
      const currencySelect = document.getElementById('currency-select');
      const bitcoinWidgetIcon = document.getElementById('bitcoin-widget-icon'); // The big B in widget

      // --- STATE & CONFIG ---
      let currentNewsCategory = 'all_crypto';
      let cachedNews = {};

      const appConfig = {
        coinGeckoApiUrl: 'https://api.coingecko.com/api/v3/simple/price',
        defaultCurrency: 'usd',
        storageKeys: {
            darkMode: 'vylexcrypto_dark_mode',
            selectedCurrency: 'vylexcrypto_currency'
        },
        cryptoQuotes: [
            "Bitcoin is Beanie Babies 2.0 without the beans.", // Sarcastic, but common
            "HODL: Hold On for Dear Life.",
            "To the moon! 🚀",
            "Not your keys, not your coins.",
            "DYOR: Do Your Own Research.",
            "Buy the dip!",
            "WAGMI: We're All Gonna Make It.",
            "Decentralization is not a destination, it's a journey.",
            "The blockchain is a solution in search of a problem... and finding many.",
            "If you don't believe it or don't get it, I don't have the time to try to convince you, sorry. - Satoshi Nakamoto (paraphrased)",
            "Stay humble, stack sats."
        ]
      };

      const redditSources = {
        all_crypto: 'https://www.reddit.com/r/CryptoCurrency/.json?limit=20',
        bitcoin: 'https://www.reddit.com/r/Bitcoin/.json?limit=20',
        ethereum: 'https://www.reddit.com/r/ethereum/.json?limit=20',
        altcoins: 'https://www.reddit.com/r/altcoin/.json?limit=20', // Consider r/CryptoMoonShots for higher risk/reward feel
        defi: 'https://www.reddit.com/r/defi/.json?limit=20',
        nfts: 'https://www.reddit.com/r/NFT/.json?limit=20'
      };

      // --- FUNCTIONS ---
      function loadPreferences() {
        const darkModeSaved = localStorage.getItem(appConfig.storageKeys.darkMode);
        if (darkModeSaved === 'false') {
            document.body.classList.remove('dark-mode');
            darkModeToggle.checked = false;
        } else {
            document.body.classList.add('dark-mode');
            darkModeToggle.checked = true;
        }

        const savedCurrency = localStorage.getItem(appConfig.storageKeys.selectedCurrency) || appConfig.defaultCurrency;
        currencySelect.value = savedCurrency;
        fetchBitcoinData(savedCurrency);
      }

      function toggleDarkMode() {
        const isDarkMode = document.body.classList.toggle('dark-mode');
        localStorage.setItem(appConfig.storageKeys.darkMode, isDarkMode);
      }

      function showError(message, context = "General") {
        clearError();
        errorContainer.innerHTML = `<div class="error"><strong>${context} Error:</strong> ${message}</div>`;
        console.error(`${context} Error Displayed:`, message);
      }

      function clearError() {
        errorContainer.innerHTML = '';
      }

      function formatCurrency(amount, currencyCode) {
        try {
            return new Intl.NumberFormat(undefined, { style: 'currency', currency: currencyCode.toUpperCase(), minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);
        } catch (e) { // Fallback for invalid currency codes if API sends something weird
            return `${currencyCode.toUpperCase()} ${amount.toFixed(2)}`;
        }
      }

      function formatMarketData(amount, currencyCode) {
         try {
            return new Intl.NumberFormat(undefined, { style: 'currency', currency: currencyCode.toUpperCase(), notation: 'compact', compactDisplay: 'short' }).format(amount);
        } catch (e) {
            return `${currencyCode.toUpperCase()} ${amount.toExponential(2)}`; // Fallback
        }
      }

      async function fetchBitcoinData(currency) {
        clearError();
        bitcoinPriceEl.textContent = 'Loading...';
        bitcoinChangeEl.textContent = '--%';
        bitcoinChangeEl.className = 'value'; // Reset color
        bitcoinMarketCapEl.textContent = '--';
        bitcoinVolumeEl.textContent = '--';
        bitcoinWidgetIcon.style.opacity = '0.5';


        try {
          const response = await fetch(`${appConfig.coinGeckoApiUrl}?ids=bitcoin&vs_currencies=${currency}&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true`);
          if (!response.ok) {
            const errorData = await response.json().catch(() => null);
            throw new Error(errorData?.error || `API request failed: ${response.statusText} (Status ${response.status})`);
          }
          const data = await response.json();

          if (!data.bitcoin || !data.bitcoin[currency.toLowerCase()]) {
            throw new Error(`Bitcoin data not found for currency: ${currency.toUpperCase()}`);
          }
          updateBitcoinWidget(data.bitcoin, currency);
          localStorage.setItem(appConfig.storageKeys.selectedCurrency, currency);

        } catch (error) {
          showError(error.message || 'Failed to fetch Bitcoin price data.', 'Bitcoin Price');
          bitcoinPriceEl.textContent = 'Error';
          bitcoinWidgetIcon.style.color = 'var(--negative-change)'; // Indicate error on icon
        } finally {
            bitcoinWidgetIcon.style.opacity = '1';
        }
      }

      function updateBitcoinWidget(bitcoinData, currency) {
        const currentPrice = bitcoinData[currency.toLowerCase()];
        const change24h = bitcoinData[`${currency.toLowerCase()}_24h_change`];
        const marketCap = bitcoinData[`${currency.toLowerCase()}_market_cap`];
        const volume24h = bitcoinData[`${currency.toLowerCase()}_24h_vol`];

        bitcoinPriceEl.textContent = formatCurrency(currentPrice, currency);
        bitcoinMarketCapEl.textContent = formatMarketData(marketCap, currency);
        bitcoinVolumeEl.textContent = formatMarketData(volume24h, currency);

        if (typeof change24h === 'number') {
            bitcoinChangeEl.textContent = `${change24h.toFixed(2)}%`;
            if (change24h > 0) {
                bitcoinChangeEl.className = 'value positive';
            } else if (change24h < 0) {
                bitcoinChangeEl.className = 'value negative';
            } else {
                bitcoinChangeEl.className = 'value';
            }
        } else {
            bitcoinChangeEl.textContent = '--%';
            bitcoinChangeEl.className = 'value';
        }
        bitcoinWidgetIcon.style.color = '#F7931A'; // Reset icon color on success
      }

      async function fetchNews(category = 'all_crypto') {
        clearError();
        loadingElement.style.display = 'block';
        newsContainer.innerHTML = '';

        if (cachedNews[category]) {
          displayNews(cachedNews[category]);
          loadingElement.style.display = 'none';
          return;
        }

        try {
          const redditUrl = redditSources[category];
          if (!redditUrl) throw new Error(`Invalid news category: ${category}`);

          const response = await fetch(redditUrl);
          if (!response.ok) {
             let errorMsg = `Failed to fetch news (status: ${response.status})`;
             try {
                const errorData = await response.json();
                errorMsg = `Reddit API Error: ${errorData.message || response.statusText} (status: ${response.status})`;
             } catch (e) { /* Ignore */ }
            throw new Error(errorMsg);
          }
          const data = await response.json();
          const posts = data?.data?.children
              .filter(post => !post?.data?.stickied && !post?.data?.over_18 && post?.data?.title) // Ensure title exists
              .slice(0, 15) || [];

          cachedNews[category] = posts;
          displayNews(posts);

        } catch (error) {
          showError(error.message || 'Failed to load news. Please try again later.', 'News Feed');
          newsContainer.innerHTML = '';
        } finally {
          loadingElement.style.display = 'none';
        }
      }

      function displayNews(posts) {
        newsContainer.innerHTML = '';
        if (!posts || posts.length === 0) {
          newsContainer.innerHTML = '<p style="text-align: center; opacity: 0.8;">No news found in this category, or Reddit is being difficult. Try again later!</p>';
          return;
        }
        posts.forEach(post => {
          const item = post.data;
          const card = document.createElement('div');
          card.className = 'card';
          const createdDate = new Date(item.created_utc * 1000);
          const formattedDate = createdDate.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
          const title = item.title.replace(/</g, "<").replace(/>/g, ">");
          let selftext = item.selftext ? item.selftext.replace(/</g, "<").replace(/>/g, ">") : '';
          if (selftext.length > 200) selftext = selftext.substring(0, 200) + '...';

          let imageUrl = '';
          if (item.preview?.images?.[0]?.source?.url) {
            imageUrl = item.preview.images[0].source.url.replace(/&/g, '&');
          } else if (item.thumbnail && item.thumbnail.startsWith('http')) {
            imageUrl = item.thumbnail;
          }

          card.innerHTML = `
            ${imageUrl ? `<img src="${imageUrl}" alt="Image for ${title.substring(0,30)}...">` : ''}
            <h3><a href="https://reddit.com${item.permalink}" target="_blank" rel="noopener noreferrer">${title}</a></h3>
            <p class="meta-info">Posted: ${formattedDate} | Subreddit: r/${item.subreddit}</p>
            <p class="meta-info">👍 ${item.ups?.toLocaleString() || 0} | 💬 ${item.num_comments?.toLocaleString() || 0} comments</p>
            ${selftext ? `<p>${selftext}</p>` : ''}
            <a href="https://reddit.com${item.permalink}" target="_blank" rel="noopener noreferrer" style="font-size: 0.9em; display: inline-block; margin-top: 10px;">Read on Reddit →</a>
          `;
          newsContainer.appendChild(card);
        });
      }

      function changeNewsCategory(category) {
        if (currentNewsCategory === category) return;
        currentNewsCategory = category;
        categoryButtons.forEach(button => {
          button.classList.toggle('active', button.dataset.source === category);
        });
        fetchNews(category);
      }

      // --- EVENT LISTENERS ---
      darkModeToggle.addEventListener('change', toggleDarkMode);

      categoryButtons.forEach(button => {
        button.addEventListener('click', () => {
          changeNewsCategory(button.dataset.source);
        });
      });

      currencySelect.addEventListener('change', (e) => {
        fetchBitcoinData(e.target.value);
      });

      // --- INITIALIZATION ---
      loadPreferences();
      fetchNews(currentNewsCategory);
      getCryptoQuote(); // Fetch initial quote

    }); // End DOMContentLoaded


    // --- Crypto Quote Function ---
    function getCryptoQuote() {
        const quoteElement = document.getElementById('quote-text');
        const quoteButton = document.getElementById('quote-button');
        const originalButtonText = quoteButton.innerHTML;

        quoteElement.style.opacity = '0.5';
        quoteElement.textContent = 'Thinking... 🤔';
        quoteButton.disabled = true;
        quoteButton.innerHTML = '💬 Fetching...';

        // Simulate API call for static quotes
        setTimeout(() => {
            const quotes = [
    "HODL: Hold On for Dear Life.",
    "To the moon! 🚀",
    "Not your keys, not your coins.",
    "DYOR: Do Your Own Research.",
    "Buy the dip!",
    "WAGMI: We're All Gonna Make It.",
    "Decentralization is not a destination, it's a journey.",
    "The blockchain is a solution in search of a problem... and finding many.",
    "If you don't believe it or don't get it, I don't have the time to try to convince you, sorry. - Satoshi Nakamoto (paraphrased)",
    "Stay humble, stack sats.",
    "Bitcoin is digital gold.",
    "The future of money is decentralized.",
    "Be your own bank.",
    "In code we trust.",
    "Sats are the new cents.",
    "Scarcity creates value — only 21 million BTC.",
    "Crypto never sleeps.",
    "Freedom is a feature, not a bug.",
    "Volatility is the price of opportunity.",
    "Trust math, not men.",
    "Bear markets build strong hands.",
    "Revolutions aren’t televised, they’re mined.",
    "Every dip is a test of your conviction.",
    "Inflation is theft in slow motion.",
    "The most secure network on Earth: Bitcoin.",
    "Crypto is borderless wealth.",
    "This isn’t just money — it’s a movement.",
    "First they ignore you, then they laugh at you, then you moon.",
    "Proof of Work > Proof of Excuses.",
    "Blockchain fixes this.",
    "Paper hands panic, diamond hands prevail.",
    "Own nothing? Nah. Own Bitcoin.",
    "Fiat fades. Code stays.",
    "Sovereignty starts with financial freedom.",
    "Bitcoin: 100% uptime since 2009.",
    "Money that obeys no master.",
    "We’re early — the world will catch up.",
    "Mining: turning energy into truth.",
    "Trustless > Trustworthy.",
    "Not a get-rich-quick scheme, but a stay-rich protocol.",
    "Crypto is hope in code form.",
    "Don’t trade emotions, trade logic.",
    "The internet of money doesn’t close.",
    "Every block, a brick in the new system.",
    "Bull runs make you money, bear markets make you rich.",
    "Stack sats like your future depends on it — because it does.",
    "Digital scarcity is real scarcity.",
    "Your wealth, your rules.",
    "Bitcoin didn’t fail — it succeeded silently.",
    "One sat at a time."
];

            const randomIndex = Math.floor(Math.random() * quotes.length);
            quoteElement.textContent = `"${quotes[randomIndex]}"`;
            quoteElement.style.opacity = '1';
            quoteButton.disabled = false;
            quoteButton.innerHTML = originalButtonText;
        }, 500); // Simulate network delay
    }
  </script>
</body>
</html>
