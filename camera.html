<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Recognition</title>
</head>
<body>
    <div>
        <button onclick="startCamera()">Start Camera</button>
        <button onclick="stopCamera()">Stop Camera</button>
        <button onclick="captureImage()">Capture Image</button>
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="recognizeText()">Recognize Text from Upload</button>
        <button onclick="recognizeFromCamera()">Recognize Text from Camera</button>
    </div>
    
    <div>
        <video id="video" width="320" height="240" autoplay style="display: none;"></video>
        <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
        <img id="capturedImage" style="display: none; max-width: 320px;">
    </div>
    
    <p id="status"></p>
    <p id="extractedText"></p>

    <script src="https://unpkg.com/tesseract.js@5.0.0/dist/tesseract.min.js"></script>

    <script>
        let stream = null;
        let capturedImageData = null;

        async function startCamera() {
            const video = document.getElementById('video');
            const status = document.getElementById('status');
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } // Use back camera on mobile
                });
                video.srcObject = stream;
                video.style.display = 'block';
                status.textContent = 'Camera started. Click "Capture Image" to take a photo.';
            } catch (error) {
                status.textContent = 'Error accessing camera: ' + error.message;
            }
        }

        function stopCamera() {
            const video = document.getElementById('video');
            const status = document.getElementById('status');
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
                video.style.display = 'none';
                status.textContent = 'Camera stopped.';
            }
        }

        function captureImage() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const capturedImage = document.getElementById('capturedImage');
            const status = document.getElementById('status');
            
            if (!stream) {
                status.textContent = 'Please start the camera first.';
                return;
            }
            
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert canvas to blob
            canvas.toBlob(blob => {
                capturedImageData = blob;
                capturedImage.src = URL.createObjectURL(blob);
                capturedImage.style.display = 'block';
                status.textContent = 'Image captured. Click "Recognize Text from Camera" to extract text.';
            }, 'image/jpeg');
        }

        async function recognizeText() {
            const imageInput = document.getElementById('imageInput');
            const extractedTextElement = document.getElementById('extractedText');
            const status = document.getElementById('status');

            if (imageInput.files.length === 0) {
                status.textContent = "Please select an image file.";
                return;
            }

            const imageFile = imageInput.files[0];
            status.textContent = "Processing image...";

            try {
                // Initialize Tesseract worker
                const worker = await Tesseract.createWorker('eng');

                // Recognize text from the image
                const { data: { text } } = await worker.recognize(imageFile);

                // Display the extracted text
                extractedTextElement.textContent = text || "No text found in the image.";
                status.textContent = "Text recognition completed.";

                // Terminate the worker to release resources
                await worker.terminate();
            } catch (error) {
                status.textContent = "Error processing image: " + error.message;
                extractedTextElement.textContent = "";
            }
        }

        async function recognizeFromCamera() {
            const extractedTextElement = document.getElementById('extractedText');
            const status = document.getElementById('status');

            if (!capturedImageData) {
                status.textContent = "Please capture an image first.";
                return;
            }

            status.textContent = "Processing captured image...";

            try {
                // Initialize Tesseract worker
                const worker = await Tesseract.createWorker('eng');

                // Recognize text from the captured image
                const { data: { text } } = await worker.recognize(capturedImageData);

                // Display the extracted text
                extractedTextElement.textContent = text || "No text found in the captured image.";
                status.textContent = "Text recognition completed.";

                // Terminate the worker to release resources
                await worker.terminate();
            } catch (error) {
                status.textContent = "Error processing captured image: " + error.message;
                extractedTextElement.textContent = "";
            }
        }
    </script>
</body>
</html>
